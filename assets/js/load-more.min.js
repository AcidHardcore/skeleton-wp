jQuery(document).ready((function(e){"use strict";new Filter}));class Filter{constructor(){this.$parentBox=$(".js-article-wrap"),this.$head=$(".articles--list"),this.$sep=this.$head.find(".js-sep"),this.$pagination=$(".pagination"),this.$pageLinks=this.$pagination.find(".page-numbers"),this.$reset=$(".as-b--link.js-reset"),this.$searchWrapper=$(".form-item-search"),this.$searchInput=this.$searchWrapper.find("input"),this.$searchReset=this.$searchWrapper.find(".search-reset.js-reset"),this.$spinner=this.$searchWrapper.find(".search-spinner"),this.url=new URL(window.location),this.params=this.url.searchParams,this.newUrl="",this.timeout=null,this.searchArgs={},this.$filters=$(".js-filter"),this.$featured=$(".js-featured-articles"),this.visualFilters=$(".gform_wrapper__resources.gform_wrapper.gravity-theme .form-custom .chosen-container .chosen-single"),this.filtersHandler(),this.searchHandler(),this.paginationHandler(),this.resetHandler(),this.historyHandler()}filtersHandler(){this.$filters.on("change",(e=>{const t=$(e.currentTarget),s=t.data("filter");args[s]=t.val(),args.paged=1,this.params.delete("pages"),this.setURLParam(s),this.getNews(args,this.$parentBox,this.$pagination),this.updateFilterBackground(t)})),this.$filters.each(((e,t)=>{const s=$(t);this.updateFilterBackground(s)}))}searchHandler(){this.$searchInput.on("keyup",(e=>{e.preventDefault(),null!==this.timeout&&clearTimeout(this.timeout),this.searchArgs=structuredClone(args),this.searchArgs.search=this.$searchInput.val(),this.searchArgs.paged=1;this.searchArgs.search.length>2&&(13!==e.keyCode?this.timeout=setTimeout((()=>{this.getTitles(this.searchArgs,this.$searchWrapper,this.$searchInput)}),1e3):(args=structuredClone(this.searchArgs),this.resetSearchResultHint(),this.params.delete("pages"),this.setURLParam("search"),this.getNews(args,this.$parentBox,this.$pagination,this.$head)))})),document.addEventListener("click",(e=>{const t=document.querySelector(".search-results");t&&(t.contains(e.target)||(this.$searchInput.val(""),this.$searchReset.addClass("hidden"),this.resetSearchResultHint()))})),this.updateSearchBackground(this.$searchInput)}paginationHandler(){this.$pageLinks.on("click",(e=>{this.scrollToTarget(this.$head),this.ajaxPagination(e)}))}resetHandler(){this.$searchReset.on("click",(e=>{e.preventDefault(),this.restAll(),this.getNews(args,this.$parentBox,this.$pagination,this.$searchWrapper)})),this.$reset.on("click",(e=>{e.preventDefault(),this.restAll(),this.$filters.each(((e,t)=>{const s=$(t);s.val("");s.find("option").each(((e,t)=>{$(t).prop("disabled",!1)})),s.next().removeClass("selected")})),this.$filters.trigger("chosen:updated"),this.$featured.removeClass("hidden"),this.$parentBox.html(""),this.$pagination.html(""),this.$head.removeClass("block-full--pad"),this.$sep.addClass("hidden"),this.scrollToTarget(this.$searchWrapper),this.updateBackgroundColor(this.visualFilters,"#d8d8d8")}))}historyHandler(){window.addEventListener("popstate",(e=>{location.reload()}))}getNews(e,t,s,a=!1){$.ajax({url:`${this.url.protocol}//${this.url.hostname}/wp-json/load-more/v1/posts/?data=${JSON.stringify(e)}`,method:"GET",dataType:"JSON",beforeSend:()=>{t.animate({opacity:.5},300),s.show()},success:e=>{e&&e.posts?(t.html(e.posts).animate({opacity:1},300),s.html(e.pagination).animate({opacity:1},300),this.hideShowFilters(e)):(t.html('<div class=""><h3>No matching results.</h3></div>').animate({opacity:1},300),s.hide())},error:e=>{t.html(`<div class=""><h3>${e.message}</h3></div>`).animate({opacity:1},300),s.hide()},complete:()=>{this.$pagination=$(".pagination"),this.$pageLinks=s.find(".page-numbers"),this.paginationHandler(),this.$head.addClass("block-full--pad"),this.$sep.removeClass("hidden"),this.$featured.addClass("hidden"),a&&this.scrollToTarget(a)}})}getTitles(e,t,s){$.ajax({url:`${this.url.protocol}//${this.url.hostname}/wp-json/load-more/v1/titles/?data=${JSON.stringify(e)}`,method:"GET",dataType:"JSON",beforeSend:()=>{this.$searchWrapper.find(".search-results").remove(),this.$spinner.removeClass("hidden"),this.$searchReset.removeClass("hidden")},success:e=>{e&&e.titles?t.append(e.titles):t.append(`<div class="search-results">No results found for ${s.val()}</div>`)},error:e=>{console.error(e)},complete:()=>{this.$spinner.addClass("hidden")}})}ajaxPagination(e){e.preventDefault();const t=$(e.currentTarget);t.attr("href");let s=t.text();"next"===s&&(s=parseInt(args.paged)+1),"prev"===s&&(s=parseInt(args.paged)-1),args.paged=s,this.setURLParam("pages",s),this.getNews(args,this.$parentBox,this.$pagination)}scrollToTarget(e){$("html, body").animate({scrollTop:e.offset().top-100},400)}setURLParam(e,t=""){t?this.params.set(e,t):null===args[e]||""===args[e]?this.params.delete(e):this.params.set(e,args[e]),this.newUrl=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${this.params.toString()}`,window.history.pushState({path:this.newUrl},"",this.newUrl),this.createCookie("filters",this.params.toString(),365),this.createCookie("resources_url",`${window.location.protocol}//${window.location.host}${window.location.pathname}`,365)}clearAllURLParams(){let e=[];this.params.forEach(((t,s)=>{e.push(s)})),e.forEach((e=>{this.params.delete(e)})),this.newUrl=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${this.params.toString()}`,window.history.pushState({path:this.newUrl},"",this.newUrl),this.createCookie("filters","",365),this.createCookie("resources_url","",365)}restAll(){this.$searchInput.val(""),args.paged=1,args.type="",args.industry="",args.category="",args.search="",this.$searchReset.addClass("hidden"),this.clearAllURLParams()}hideShowFilters(e){this.$filters.each(((t,s)=>{const a=$(s),r=a.data("filter");a.find("option").each(((t,s)=>{const a=$(s);"resource_type"!==r||Object.values(e.resource_type).includes(a.val())||a.prop("disabled",!0),"industry"!==r||Object.values(e.industry).includes(a.val())||a.prop("disabled",!0),"category"!==r||Object.values(e.category).includes(a.val())||a.prop("disabled",!0),"resource_type"===r&&Object.values(e.resource_type).includes(a.val())&&a.prop("disabled",!1),"industry"===r&&Object.values(e.industry).includes(a.val())&&a.prop("disabled",!1),"category"===r&&Object.values(e.category).includes(a.val())&&a.prop("disabled",!1)})),a.trigger("chosen:updated")}))}resetSearchResultHint(){this.searchArgs={},this.$searchWrapper.find(".search-results").remove()}updateBackgroundColor(e,t){e.css("background-color",t)}updateFilterBackground(e){""!==e.val()&&this.updateBackgroundColor(e.closest(".form-item").find(".chosen-single"),"#ffffff"),null!==e.val()&&""!==e.val()||this.updateBackgroundColor(e.closest(".form-item").find(".chosen-single"),"#d8d8d8")}updateSearchBackground(e){""!==e.val()&&this.updateBackgroundColor(e,"#ffffff")}createCookie(e,t,s){let a;if(s){let e=new Date;e.setTime(e.getTime()+24*s*60*60*1e3),a="; expires="+e.toGMTString()}else a="";const r=new URL(window.location).hostname;document.cookie=e+"="+t+a+"; path=/; domain=."+r}}